# x264-OPT

修改汇编部分，尝试获得更好的性能（也可能不幸负优化），做视频总要用到，多一点性能是一点（其实是强迫症）

有些函数原本也做得很好了，单纯是看宏不爽就完全展开了

## 8bit only

懒得再去改10bit了，8bit的x264至少目前还是覆盖了很大部分的应用场景，10bit的x264只在本地高画质视频见过，没有硬解支持对高分辨率也不友好，要10bit我为什么不用x265呢

## AVX2 only

主力机是Haswell的E3 V3，就这都是好多年前的东西了，反正这也是我自己的魔改，到了今天再去管更古老的CPU没啥意义

在家里测试只有Skylake的笔记本，因为执行单元的差异不算太大，Haswell应该也能有提升，虽然幅度会小点

## 有较大提升的部分

* MMX代码，虽然说小向量放进去没什么问题，但MMX能使用的执行端口更少，跑起来差别相当大
* 没有充分优化的部分，翻原本的代码发现有的地方前面用了更新更优化的算法，后面结构基本相同但是还是用的旧算法，不是很懂就是了

## 没啥提升的部分

原本就做得相当好的地方，发现我的想法跟它一样，就当作我把宏展开了吧

## 总体性能的考量

就算改了某个函数有了个50%的提升，那也是众多函数中的一个，在上层还有很多C写的处理逻辑，总体性能可能还没啥变化，只能是做完一轮再测试了

## 相关资源

主要参考了[Agner的资源](https://www.agner.org/optimize/)，测试用的计时器也是从这里拿来用的
